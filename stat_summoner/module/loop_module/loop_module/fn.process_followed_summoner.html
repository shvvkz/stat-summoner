<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="⚙️ Function: Processes a followed summoner by checking if their follow time has expired or if they have played a new match."><title>process_followed_summoner in stat_summoner::module::loop_module::loop_module - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-c5d6553a23f1e5a6.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="stat_summoner" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0 (eeb90cda1 2024-09-04)" data-channel="1.81.0" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../stat_summoner/index.html">stat_summoner</a><span class="version">0.2.1</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In stat_summoner::module::loop_module::loop_module</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../../../index.html">stat_summoner</a>::<wbr><a href="../../index.html">module</a>::<wbr><a href="../index.html">loop_module</a>::<wbr><a href="index.html">loop_module</a>::<wbr><a class="fn" href="#">process_followed_summoner</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../../src/stat_summoner/module/loop_module/loop_module.rs.html#136-156">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>async fn process_followed_summoner(
    collection: &amp;<a class="struct" href="https://docs.rs/mongodb/3.1.0/mongodb/coll/struct.Collection.html" title="struct mongodb::coll::Collection">Collection</a>&lt;<a class="struct" href="../../../models/data/struct.SummonerFollowedData.html" title="struct stat_summoner::models::data::SummonerFollowedData">SummonerFollowedData</a>&gt;,
    followed_summoner: &amp;<a class="struct" href="../../../models/data/struct.SummonerFollowedData.html" title="struct stat_summoner::models::data::SummonerFollowedData">SummonerFollowedData</a>,
    riot_api_key: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.str.html">str</a>,
    http: <a class="struct" href="https://doc.rust-lang.org/1.81.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;<a class="struct" href="https://docs.rs/serenity/*/serenity/http/client/struct.Http.html" title="struct serenity::http::client::Http">Http</a>&gt;,
    collection_emojis: <a class="struct" href="https://docs.rs/mongodb/3.1.0/mongodb/coll/struct.Collection.html" title="struct mongodb::coll::Collection">Collection</a>&lt;<a class="struct" href="../../../models/data/struct.EmojiId.html" title="struct stat_summoner::models::data::EmojiId">EmojiId</a>&gt;,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.81.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.unit.html">()</a>, <a class="struct" href="https://doc.rust-lang.org/1.81.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.81.0/core/error/trait.Error.html" title="trait core::error::Error">Error</a> + <a class="trait" href="https://doc.rust-lang.org/1.81.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + <a class="trait" href="https://doc.rust-lang.org/1.81.0/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a>&gt;&gt;</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>⚙️ <strong>Function</strong>: Processes a followed summoner by checking if their follow time has expired or if they have played a new match.</p>
<p>This asynchronous function handles the logic for a followed summoner. It checks if the follow time has expired and removes the summoner from the database if necessary. If the follow time is still valid, it checks for new matches and updates the summoner’s information accordingly.</p>
<h2 id="parameters"><a class="doc-anchor" href="#parameters">§</a>Parameters:</h2>
<ul>
<li><code>collection</code>: A reference to a MongoDB <code>Collection&lt;SummonerFollowedData&gt;</code> that stores the followed summoners’ data.</li>
<li><code>followed_summoner</code>: A reference to a <code>SummonerFollowedData</code> struct containing the summoner’s information, including their follow duration and last match details.</li>
<li><code>riot_api_key</code>: A string slice containing the Riot Games API key for authenticating the API request.</li>
<li><code>http</code>: An <code>Arc&lt;Http&gt;</code> object used to send messages via the Discord API.</li>
<li><code>collection_emojis</code>: A MongoDB <code>Collection</code> containing emoji mappings, used to enrich the Discord embeds with custom emojis for roles and champions.</li>
</ul>
<h2 id="returns"><a class="doc-anchor" href="#returns">§</a>Returns:</h2>
<ul>
<li><code>Result&lt;(), Error&gt;</code>: Returns <code>Ok(())</code> if the summoner was successfully processed (either by removing them from the database or updating their match info), or an error if something went wrong.</li>
</ul>
<h2 id="example"><a class="doc-anchor" href="#example">§</a>Example:</h2>
<p>This function is typically called as part of a loop or scheduled task that checks the status of followed summoners:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>result = process_followed_summoner(collection, <span class="kw-2">&amp;</span>followed_summoner, riot_api_key, http.clone(), collection_emojis).<span class="kw">await</span>;
<span class="kw">if </span>result.is_err() {
    <span class="comment">// Handle error (e.g., log failure or retry)
</span>}</code></pre></div>
<h2 id="notes"><a class="doc-anchor" href="#notes">§</a>Notes:</h2>
<ul>
<li>The function begins by checking if the follow time for the summoner has expired using the <code>is_follow_time_expired</code> function.</li>
<li>If the follow time has expired, the summoner is removed from the MongoDB collection by calling <code>delete_follower</code>.</li>
<li>If the summoner is still being followed, the function calls <code>update_follower_if_new_match</code> to check for new matches and potentially send an update to the associated Discord channel.</li>
<li>This function ensures that summoners are only followed for the specified duration and that Discord channels are updated with relevant match information during the follow period.</li>
</ul>
</div></details></section></div></main></body></html>